---
title: "[Java] Java 8 에서 자주 만나는 것들 2"
excerpt: "Lambda, Stream, Optional"

categories:
  - Development
tags:
  - java
header:
  teaser: /assets/images/dev/java.png
---

<small>참조 : [http://tcpschool.com/java/java_stream_concept](http://tcpschool.com/java/java_stream_concept)</small>

## Stream

Java에서 배열이나 컬렉션을 사용하는 경우가 많은데, 요소에 접근할 때 반복문이나 반복자(iterator)를 사용한다. 이는 코드를 길어지게 하고, 가독성이 떨어지고, 재사용이 거의 불가능하다.

따라서 Java 8 부터는 Stream API를 도입한다. Stream은 다음과 같은 특징을 가진다.

### Stream의 특징

1. 원본 데이터를 변경하지 않는다. 참조만 할 뿐이다.
2. 재사용할 수 없다.(1회용) 필요하다면 결과를 컬렉션이나 배열에 담는다.
3. 외부 반복이 아닌 내부 반복을 통해 작업을 수행한다. 즉 반복에 필요한 코드가 노출되지 않는다.
4. filter-map 기반의 API를 사용하여 지연(lazy) 연산을 통해 성능을 최적화한다. 곧바로 연산을 수행하는 것이 아닌, 마지막에 어떤 연산이 필요로 하는가를 판단한 후에 연산을 한다.
5. `parallelStream()` 메소드를 통해 병렬 처리가 손쉽다.

## Stream 생성

Stream의 생성 방법이 다양한데 예제와 함께 알아보자.

### `Collections` 인터페이스의 `stream()` 메소드

```java
private static void streamPractice1() {
  ArrayList<Integer> list = new ArrayList<>();

  list.add(4);
  list.add(2);
  list.add(3);
  list.add(1);

  Stream<Integer> stream = list.stream();
  stream.map(i -> i + " ").forEach(System.out::print);
}
```

```shell
4 2 3 1
```

`stream()`메소드는 `Collection` 인터페이스에 있는 메소드로 `ArrayList`, `HashSet` 등을 stream으로 만들 수 있다.

그 외에 `map()`이나 `forEach()`는 뒤에서 다룰 것이다.

### `Arrays` 클래스의 `stream()` 메소드

```java
private static void streamPractice2() {
  String[] arr = new String[] {"넷", "둘", "셋", "하나"};

  Stream<String> stream = Arrays.stream(arr);
  stream.forEach(e -> System.out.print(e + " "));
  System.out.println();

  Arrays.stream(arr, 1, 3).forEach(e -> System.out.print(e + " "));
}
```

```shell
딸기 당근 수박 참외 메론
당근 수박
```

배열에 대해서는 `Arrays` 클래스의 `stream()` 메소드를 사용하며, 또한 특정 부분만을 Stream으로 생성할 수 있다.

### `Stream` 클래스의 `of()` 메소드

```java
private static void streamPractice3() {
  Stream<Double> stream1 = Stream.of(3.14, 1.57, 2.0, 5.55555, 3.11);
  stream1.map(d -> d + " ").forEach(System.out::print);

  System.out.println();

  Stream<Integer> stream2 = Stream.of(100, 200);
  stream2.map(d -> d + " ").forEach(System.out::print);
}
```

```shell
3.14 1.57 2.0 5.55555 3.11
100 200
```

`Stream` 클래스의 `of()` 메소드를 사용하여 가변 매개변수를 사용할 수도 있다.

### `IntStream` 인터페이스의 `range()` 메소드

```java
private static void streamPractice4() {
  IntStream stream1 = IntStream.range(1, 5);
  stream1.forEach(System.out::print);
}
```

```shell
1234
```

python 반복문 배울 때 신박하다고 생각했던 range를 여기서 다시 보게 되니 반갑다. 지정된 범위의 연속된 정수를 스트림으로 생성하기 위해서 `IntStream` 인터페이스의 `range()` 메소드를 사용할 수 있다.

다른 인터페이스로 `LongStream`도 있으며, `rangeClosed()` 메소드도 있다. `rangeClosed()`는 이름에서도 알 수 있듯이 `range()`에서 두 번째 매개변수를 제외한다면 `rangeClosed()`는 포함한다.

### `Random` 클래스의 `ints()` 메소드

```java
private static void streamPractice5() {
  IntStream stream = new Random().ints(4);
  stream.forEach(System.out::println);
}
```

```shell
2058464775
-328584945
-326803370
817906855
```

`Random` 클래스에는 `ints()` 메소드 뿐 아니라 `longs()`, `doubles()`와 같은 메소드도 있다. 이 메소드들의 매개변수는 개수를 의미하며, 이게 없으면 무한 스트림(infinite stream)을 생성한다. 무한 스트림은 `limit()` 메소드를 사용하여 개수를 제한할 수 있다.

### `Stream` 클래스의 `iterate()` 메소드

```java
private static void streamPractice6() {
  Stream<Integer> stream1 = Stream.iterate(2, n -> n+2);
  stream1.limit(5).forEach((i) -> System.out.print(i + " "));

  System.out.println();

  Stream<Integer> stream2 = Stream.generate(() -> 5);
  stream2.limit(5).forEach((i) -> System.out.print(i + " "));
}
```

```shell
2 4 6 8 10
5 5 5 5 5
```

`iterate()` 메소드는 람다 표현식을 사용하여, 반환된 값을 다시 사용하는 방식으로 무한 스트림을 생성한다.

`generate()` 메소드는 매개변수를 받지 않는 람다 표현식을 사용하여, 반환된 값으로 무한 스트림을 생성한다.

## Stream의 중개 연산
